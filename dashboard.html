<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>PADOC - WebClient</title>

    <!-- Bootstrap Core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="css/sb-admin.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- Editable Table -->
    <link href="css/table-editable.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- jQuery -->
    <!--<script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>-->
    <script src="js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="js/bootstrap.min.js"></script>

    <!-- Script Principal -->
    <script src="js/principal.js"></script>

    <!-- Table to JSON -->
    <script type="text/javascript" src="js/jquery.tabletojson.min.js"></script> 

    <!-- PRETTY DIFF -->
    <script type="text/javascript" src="js/prettydiff.js"></script>
    <link rel="stylesheet" type="text/css" href="css/diffview.css" media="all"/>
    
    <!-- JSON-Diff -->
    <script type="text/javascript" src="public/build/jsondiffpatch.js"></script> 
    <script type="text/javascript" src="public/build/jsondiffpatch-formatters.js"></script> 
    <link rel="stylesheet" href="public/formatters-styles/html.css" type="text/css" />
    <link rel="stylesheet" href="public/formatters-styles/annotated.css" type="text/css" />

    </head>

    <body>
        <div id="wrapper">
            <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="index.html">PADOC</a>
                </div>
                <ul class="nav navbar-right top-nav" id="navbarTopRight">
                </ul>
                <div class="collapse navbar-collapse navbar-ex1-collapse">
                    <ul class="nav navbar-nav side-nav">
                        <li clas="active">
                            <a href="index.html"><i class="fa fa-fw fa-dashboard"></i> Dashboard</a>
                        </li>
                    </ul>
                </div>
            </nav>

            <div id="page-wrapper">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-lg-12">
                            <h1 class="page-header">
                                Dashboard
                                <small>PADOC - Sistema de Avaliação</small>
                            </h1>
                            <ol class="breadcrumb">
                                <li>
                                    <i class="fa fa-dashboard"></i>  <a href="index.html">Home</a>
                                </li>
                                <li class="active">
                                    <i class="fa fa-file"></i> Dashboard
                                </li>
                            </ol>
                        </div>
                    </div>

                    <!-- INICIO DADOS GERAIS DO DOCENTE E PAINEL DE CONTROLE -->
                    <div class="row">
                        <div class="col-lg-10">
                            <p id="siape"><strong>SIAPE:</strong> </p>
                            <p id="ingressoUfg"><strong>Data de ingresso na UFG:</strong> </p>
                            <p id="ingressoServicoPublico"><strong>Data de ingresso na carreira pública:</strong> </p>
                            <br/>
                        </div>
                        <div class="col-lg-2" style="text-align: center;">
                            <br/>
                            <button type="button" class="btn btn-lg btn-primary" data-toggle="modal" data-target="#modalMudancas" id="btnExibirLogDeMudancas">Log de mudanças</button>
                            <br/>
                        </div>
                    </div>
                    <!-- FIM DADOS GERAIS DO DOCENTE E PAINEL DE CONTROLE -->

                    <!-- INÍCIO APRESENTAÇÃO DAS TABELAS -->
                    <div class="row">
                        <div class="col-lg-12">
                            <div id="retornoJson">

                            </div>
                        </div>
                    </div>
                    <!-- FIM APRESENTAÇÃO DAS TABELAS -->

                    <div id="visual"></div>

                    <!-- INICIO MODAL LOG DE MUDANÇAS -->
                    <div class="modal fade" id="modalMudancas" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                        <div class="modal-dialog" style="width: 90%;">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                    <h4 class="modal-title" id="tituloModal">Log de Mudanças</h4>
                                </div>
                                <div class="modal-body">
                                    <div class="row">
                                        <div class="col-lg-12">
                                            <div id="jsonDiffVisual" style="width: 80%">
                                                
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-default" data-dismiss="modal">Fechar</button>
                                    <button type="button" class="btn btn-primary" id="edit_client_btn">Salvar</button>
                                </div>
                            </div>
                            <!-- /.modal-content -->
                        </div>
                        <!-- /.modal-dialog -->
                    </div>
                    <!-- FIM MODAL LOG DE MUDANÇAS -->

                    <div  class="row">
                        <div class="col-lg-12">
                            <div id="diffoutput">
                                
                            </div>
                        </div>
                    </div>

                    <!-- PRETTY DIFF -->
                    <!--<span class="clear"></span><div id="diffoutput">
                    <iframe id="iFrame" width="800px" height="800px" scrolling="auto" frameborder="1" align="center" src="teste.html">
                        
                    </iframe>-->
                </div>
            </div>
        </div>

        <script type="text/javascript">
            jQuery(document).ready(function($){
            // POPULA A PÁGINA
            imprimeInformacoesDocente();
            carregaJsonEntrada();

            $("#btnExibirLogDeMudancas").click(function(){

                // Variáveis
                var retornoJson = {};
                var arrayPeriodos = [];


                retornoJson["siape"] = GLOBAL_requestResponse["siape"];
                retornoJson["data-ingresso-na-ufg"] = GLOBAL_requestResponse["data-ingresso-na-ufg"];
                retornoJson["data-ingresso-servico-publico"] = GLOBAL_requestResponse["data-ingresso-servico-publico"];

                //alert(JSON.stringify(retornoJson));

                for (var i = 0; i < GLOBAL_requestResponse["periodos"].length; i++) {

                    var objetoPeriodoGERAL = {}; // representa o período como um todo
                    var tabela; // vai ser usada pelo tableToJSON() para todas as tabelas
                    var objetoPeriodo; // periodo interno, composto somente de inicio e fim


                    // FORMATANDO PERÍODO INTERNO
                    objetoPeriodo = formataPeriodo(GLOBAL_requestResponse["periodos"][i]);
                    objetoPeriodoGERAL["periodo"] = objetoPeriodo;
                    
                    
                    // FORMATANDO A TABELA DE DADOS DO DOCENTE
                    tabela = $("#dados-do-docente-"+i).tableToJSON();
                    objetoPeriodoGERAL["dados-do-docente"] = formataTabelaDadosDoDocente(tabela);
                    //alert(JSON.stringify(objetoPeriodoGERAL));

                    // FORMATANDO A TABELA DE AFASTAMENTO
                    tabela = $("#afastamento-"+i).tableToJSON();
                    objetoPeriodoGERAL["afastamento"] = formataTabelaAfastamento(tabela);
                    //alert(JSON.stringify(objetoPeriodoGERAL));

                    // FORMATANDO A TABELA ATIVIDADES DE ENSINO
                    tabela = $("#atividades-de-ensino-"+i).tableToJSON();
                    objetoPeriodoGERAL["atividades-de-ensino"] = formataTabelaAtividadesDeEnsino(tabela);
                    //alert(JSON.stringify(objetoPeriodoGERAL));

                    // FORMATANDO A TABELA DE ATIVIDADES DE ORIENTAÇÃO
                    tabela = $("#atividades-de-orientacao-"+i).tableToJSON();
                    objetoPeriodoGERAL["atividades-de-orientacao"] = formataTabelaAtividadesDeOrientacao(tabela);
                    //console.log(JSON.stringify(objetoPeriodoGERAL));

                    // FORMATANDO A TABELA DE ATIVIDADES EM PROJETOS
                    tabela = $("#atividades-em-projetos-"+i).tableToJSON();
                    objetoPeriodoGERAL["atividades-em-projetos"] = formataTabelaAtividadesEmProjetos(tabela);
                    //console.log(JSON.stringify(objetoPeriodoGERAL));

                    // FORMATANDO A TABELA DE ATIVIDADES DE EXTENSÃO
                    tabela = $("#atividades-de-extensao-"+i).tableToJSON();
                    objetoPeriodoGERAL["atividades-de-extensao"] = formataTabelaAtividadesDeExtensao(tabela);
                    //console.log(JSON.stringify(objetoPeriodoGERAL));

                    // FORMATANDO ATIVIDADES DE QUALIFICAÇÃO
                    tabela = $("#atividades-de-qualificacao-"+i).tableToJSON();
                    objetoPeriodoGERAL["atividades-de-qualificacao"] = formataTabelaAtividadesDeQualificacao(tabela);
                    //console.log(JSON.stringify(objetoPeriodoGERAL));

                    // FORMATANDO A TABELA ATIVIDADES ACADEMICAS ESPECIAIS
                    tabela = $("#atividades-academicas-especiais-"+i).tableToJSON();
                    objetoPeriodoGERAL["atividades-academicas-especiais"] = formataTabelaAtividadesAcademicasEspeciais(tabela);
                    //console.log(JSON.stringify(objetoPeriodoGERAL));

                    // FORMATANDO A TABELA ATIVIDADES ADMINISTRATIVAS
                    tabela = $("#atividades-administrativas-"+i).tableToJSON();
                    objetoPeriodoGERAL["atividades-administrativas"] = formataTabelaAtividadesAdministrativas(tabela);
                    //console.log(JSON.stringify(objetoPeriodoGERAL));

                    // FORMATANDO A TABELA PRODUTOS
                    tabela = $("#produtos-"+i).tableToJSON();
                    objetoPeriodoGERAL["produtos"] = formataTabelaProdutos(tabela);
                    //console.log(JSON.stringify(objetoPeriodoGERAL));


                    arrayPeriodos.push(objetoPeriodoGERAL);
                };

                retornoJson["periodos"] = arrayPeriodos;
                //alert(JSON.stringify(retornoJson));

                // INICIO DO JSON DIFF
                GLOBAL_right = retornoJson;

                GLOBAL_right = JSON.stringify(GLOBAL_right);

                //var delta = jsondiffpatch.diff(GLOBAL_left, GLOBAL_right);
                //$("#diffoutput").html(jsondiffpatch.formatters.html.format(delta, GLOBAL_left));


                
                args = {
                    source: GLOBAL_left,
                    diff: GLOBAL_right,
                    objsort: "none",
                    lang: "auto",
                    diffview: "inline"
                };
    
                var output = prettydiff(args);

                $("#jsonDiffVisual").html(output[0]);
                //console.log(output);


                /*var iframe = document.createElement('iframe');
                iframe.frameBorder = 1;
                //iframe.width = "500px";
                //iframe.height = "500px";
                iframe.id = "iframe";
                //iframe.src = "teste.html";

                iframe.onload = function()
                {
                    var doc = iframe.contentDocument || iframe.contentWindow.document;
                    //var div = doc.createElement('div');
                    doc.html = output[0];
                    //div.textContent = "Paragraph in iframe";
                    //doc.body.appendChild(div);
                };

                document.getElementById("iFrameReceiver").appendChild(iframe); //this is a div  that I have in body.

                
                

                
                //$("#diffoutput").append( output[0] );
                //$("#iFrame").html("</div>" + output[0]);
                //return heading + output[1] + "</div>" + output[0] + "</body></html>";


                /*alert(GLOBAL_left);
                alert(GLOBAL_right);
                var delta = JSON.stringify(jsondiffpatch.diff(GLOBAL_left, GLOBAL_right));

    

                $.ajax({
                    type: "POST",
                    url: "http://prettydiff.com",
                    data: {
                        l: "html",
                        m: "diff",
                        source: GLOBAL_left,
                        diff: GLOBAL_right
                    }
                });*/
                //window.open("http://prettydiff.com/?l=html&m=diff&diff=" +GLOBAL_right +"&source=" +GLOBAL_left );

                // http://prettydiff.com/?l=html&m=diff&

                //console.log(JSON.stringify(jsondiff.diff(GLOBAL_right, GLOBAL_left)));
                

                //$("#modalMudancas").html(jsondiffpatch.formatters.html.format(delta, GLOBAL_left));
                //document.getElementById('modalMudancas').innerHTML = jsondiffpatch.formatters.html.format(delta, GLOBAL_left);

            });  



            // FUNÇÕES QUE AUXILIAM NA FORMATAÇÃO DO JSON DE RETORNO
            function formataPeriodo(GLOBAL){

                var aux = {};

                aux["inicio"] = GLOBAL["periodo"]["inicio"];
                aux["fim"] = GLOBAL["periodo"]["fim"];

                return aux;
            }

            function formataTabelaDadosDoDocente(tabela){

                var aux = {};

                aux["nome"] = tabela[0]["nome"];
                aux["unidade"] = tabela[0]["unidade"];
                aux["titulacao"] = tabela[0]["titulacao"];
                aux["regime-de-trabalho"] = tabela[0]["regime-de-trabalho"];
                aux["classe"] = tabela[0]["classe"];
                aux["nivel"] = tabela[0]["nivel"];
                aux["ch-contratada"] = tabela[0]["ch-contratada"];
                aux["ch-executada"] = tabela[0]["ch-executada"];
                aux["email"] = tabela[0]["email"];

                return aux;

            }

            function formataTabelaAfastamento(tabela){

                var aux = {};

                //aux = tabela[0];

                return aux;
            }

            function formataTabelaAtividadesDeEnsino(tabela){

                var arrAux = [];
                
                for (var i = 0; i < tabela.length; i++) {

                    var aux = {};
                    aux["curso"] = tabela[i]["curso"];
                    aux["disciplina"] = tabela[i]["disciplina"];
                    aux["cha"] = JSON.parse(tabela[i]["cha"]);
                    aux["ano"] = JSON.parse(tabela[i]["ano"]);
                    aux["sem"] = JSON.parse(tabela[i]["sem"]);
                    aux["turma"] = tabela[i]["turma"];
                    aux["sub"] = tabela[i]["sub"];
                    aux["numero-alunos"] = JSON.parse(tabela[i]["numero-alunos"]);
                    aux["numero-sub"] = JSON.parse(tabela[i]["numero-sub"]);
                    aux["cht"] = JSON.parse(tabela[i]["cht"]);
                    aux["chp"] = JSON.parse(tabela[i]["chp"]);
                    aux["chac"] = tabela[i]["chac"];
                    aux["conjugada"] = JSON.parse(tabela[i]["conjugada"]);                    

                    arrAux.push(aux);
                };

                return arrAux;
            }

            function formataTabelaAtividadesDeOrientacao(tabela){

                var arrAux = [];
                
                for (var i = 0; i < tabela.length; i++) {

                    var aux = {};
                    aux["titulo-do-trabalho"] = tabela[i]["titulo-do-trabalho"];
                    aux["tabela"] = tabela[i]["tabela"];
                    aux["estudante"] = tabela[i]["estudante"];
                    aux["matricula"] = tabela[i]["matricula"];
                    aux["funcao-do-docente"] = tabela[i]["funcao-do-docente"];
                    aux["nivel"] = tabela[i]["nivel"];
                    aux["curso"] = tabela[i]["curso"];
                    aux["ies"] = tabela[i]["ies"];
                    aux["cha"] = JSON.parse(tabela[i]["cha"]);
                    aux["periodo"] = {"inicio": tabela[i]["inicio"], "fim": tabela[i]["fim"]};
                    aux["tipo-orientacao"] = tabela[i]["tipo-orientacao"];

                    arrAux.push(aux);
                };

                return arrAux;
            }

            function formataTabelaAtividadesEmProjetos(tabela){

                var arrAux = [];

                for (var i = 0; i < tabela.length; i++) {

                    var aux = {};
                    aux["titulo-do-projeto"] = tabela[i]["titulo-do-projeto"];
                    aux["tabela"] = tabela[i]["tabela"];
                    aux["unidade-responsavel"] = tabela[i]["unidade-responsavel"];
                    aux["tipo"] = tabela[i]["tipo"];
                    aux["situacao"] = tabela[i]["situacao"];
                    aux["funcao"] = tabela[i]["funcao"];
                    aux["financiado"] = tabela[i]["financiado"];
                    aux["cha"] = JSON.parse(tabela[i]["cha"]);
                    aux["periodo"] = {"inicio": tabela[i]["inicio"], "fim":tabela[i]["fim"]};

                    arrAux.push(aux);
                };

                return arrAux;
            }

            function formataTabelaAtividadesDeExtensao(tabela){

                var arrAux = [];

                for (var i = 0; i < tabela.length; i++) {

                    var aux = {};
                    aux["tabela"] = tabela[i]["tabela"];
                    aux["cha"] = JSON.parse(tabela[i]["cha"]);
                    aux["periodo"] = {"inicio":tabela[i]["inicio"], "fim":tabela[i]["fim"]};
                    aux["descricao"] = tabela[i]["descricao"];
                    aux["clientela"] = tabela[i]["clientela"];                    

                    arrAux.push(aux);
                };

                return arrAux;

            }

            function formataTabelaAtividadesDeQualificacao(tabela){

                var arrAux = [];

                for (var i = 0; i < tabela.length; i++) {

                    var aux = {};
                    aux["tabela"] = tabela[i]["tabela"];
                    aux["descricao"] = tabela[i]["descricao"];
                    aux["cha"] = JSON.parse(tabela[i]["cha"]);
                    aux["periodo"] = {"inicio":tabela[i]["inicio"], "fim":tabela[i]["fim"]};
                    
                    arrAux.push(aux);
                };

                return arrAux;
            }

            function formataTabelaAtividadesAcademicasEspeciais(tabela){

                var arrAux = [];

                for (var i = 0; i < tabela.length; i++) {

                    var aux = {};
                    aux["tabela"] = tabela[i]["tabela"];
                    aux["cha"] = JSON.parse(tabela[i]["cha"]);
                    aux["periodo"] = {"inicio":tabela[i]["inicio"], "fim":tabela[i]["fim"]};
                    aux["descricao"] = tabela[i]["descricao"];
                    aux["clientela"] = tabela[i]["clientela"];

                    arrAux.push(aux);
                };

                return arrAux;
            }

            function formataTabelaAtividadesAdministrativas(tabela){

                var arrAux = [];

                for (var i = 0; i < tabela.length; i++) {

                    var aux = {};
                    aux["tabela"] = tabela[i]["tabela"];
                    aux["cha"] = JSON.parse(tabela[i]["cha"]);
                    aux["periodo"] = {"inicio":tabela[i]["inicio"], "fim":tabela[i]["fim"]};
                    aux["descricao"] = tabela[i]["descricao"];
                    aux["emissor"] = tabela[i]["emissor"];
                    aux["orgao-servido"] = tabela[i]["orgao-servido"];
                    aux["portaria"] = tabela[i]["portaria"];

                    arrAux.push(aux);
                };

                return arrAux;
            }

            function formataTabelaProdutos(tabela){

                var arrAux = [];

                for (var i = 0; i < tabela.length; i++) {

                    var aux = {};
                    aux["descricao"] = tabela[i]["descricao"];
                    aux["titulo"] = tabela[i]["titulo"];
                    aux["autoria"] = tabela[i]["autoria"];
                    aux["associacao-do-produto"] = tabela[i]["associacao-do-produto"];
                    aux["projeto-associado"] = tabela[i]["projeto-associado"];
                    aux["veiculacao"] = tabela[i]["veiculacao"];
                    aux["local"] = tabela[i]["local"];
                    aux["data"] = tabela[i]["data"];
                    aux["ano-da-publicacao"] = JSON.parse(tabela[i]["ano-da-publicacao"]);
                    aux["pagina-inicial"] = tabela[i]["pagina-inicial"];
                    aux["pagina-final"] = tabela[i]["pagina-final"];
                    aux["numero-de-paginas"] = JSON.parse(tabela[i]["numero-de-paginas"]);
                    aux["numero-da-patente"] = tabela[i]["numero-da-patente"];

                    arrAux.push(aux);
                };

                return arrAux;
            }

        });
</script>
</body>
</html>
